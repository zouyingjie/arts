### 一. Algorithm

做了 [105. Construct Binary Tree from Preorder and Inorder Traversal](https://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/) 和 [106. Construct Binary Tree from Inorder and Postorder Traversal](https://leetcode.com/problems/construct-binary-tree-from-inorder-and-postorder-traversal/)。

首先是 105 题，基于前序遍历数据和中序遍历数组构建出二叉树。通过前序遍历可以很容易知道其第一个元素就是根节点，重点在于如果拿到根节点后在找到左右子节点。要解出这道题目重点在于理解前序、中序遍历的数组的特点：

- 前序遍历数组中，第一个节点是根节点，接下来是左子树的节点，然后是右子树的节点。
- 中序遍历数组中，根节点两侧是左右子树节点。

如图：

![](https://github.com/zouyingjie/arts/blob/master/image/leetcode_105.jpg)

那么我们先拿到前序遍历的第一个元素，即为根节点，然后找到其在中序遍历数组中的位置，那么左右两侧即为左右子树节点。知道左右子树个数后，就可以知道前序数据中右子节点的位置了。


### 二. Review

读微软云设计模式系列之:[Ambassador pattern（外交官模式）](https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador)。通过创建一个 Ambassador 辅助服务来代表我们的应用与外界客户端进行请求交互，可以将 Ambassador 辅助服务看做是和应用部署在同一台主机上的代理。

#### 1. 问题来源

基于云的应用的弹力设计需要有熔断、路由、计量、监控以及对于网络相关配置的升级等功能。这些功能在遗留系统或者某些库中可能较难实现，因为这些代码可能已经不再维护或者修改成本很大。另外对于网络调用可能也需要连接、校验、授权等相关的配置，如果有多个不同语言或者框架实现的应用需要互相访问，那么我们需要针对每一个应用做单独的配置，这样会带来极大的运维成本。

#### 2. 解决方案

通过创建一个外部进程来充当应用和外部服务之间的代理，将进程与我们的应用部署在同一个主机上，并提供路由，弹性设计、安全等功能，并且避免任何与主机相关的访问限制。另外该进程还可以监控请求延迟、资源占用相关的指标，因为进程与应用是在同一主机上，因此可以直观的展示应用的资源占用情况。设计如图：

![](https://docs.microsoft.com/en-us/azure/architecture/patterns/_images/ambassador.png)。

代理服务中的功能是可以随时修改的，并且不会影响到我们正式服务的使用。并且我们可以有专门的团队来维护 Ambassador 服务。Ambassador 服务也可以设计成边车模式，也就是说该服务的生命周期和正式服务是一致的。另外如果 Ambassador 服务为同一个主机上的多个应用提供代理，可以将该服务设置为一个守护进程运行。如果应用是集装箱化的，也就是通过容器等实现的，那么 Ambassador 服务也应该采用类似的实现，并与正式服务之间建立联系。

#### 3. 问题与思考

- 添加代理会造成一定的请求延迟，因此在使用时需要和采用 sdk、库的形式或者直接调用等方式相比较，选择更加合适的方案。
- 考虑 Ambassador 服务中的特性是否合理，比如可以通过 Ambassador 服务进行请求重试，但是需要保证重试的幂等性。
- 可以考虑实现一种机制，将客户端的上下文发送给 Ambassador 服务，比如请求的 Header，客户端设置的重试次数等。
- 仔细思考打包和部署策略。
- 认真斟酌是采用 一对多还是一对一的方式提供 Ambassador 服务。

#### 4. 使用时机

***比较合适的使用场景***

- 需要为多种语言和框架提供一个通用的客户端访问时。
- 需要将多个客户端之间的交叉请求问题整合到基础架构之中或者需要由专门的团队开发运维时需要构建 Ambassador 服务
- 对于某些旧的或者难以修改的应用提供类似功能时，此时一般只能创建 Ambassador 服务来实现。

***不合适的场景***

- 对于请求延迟特别敏感的服务不适合，因为 Ambassador 服务会引入延迟，可能引发问题。
- 当客户端团队只有一种开发语言时，此时采用包的形式分发给客户端是更好的选择。
- 当连接功能与客户端需要深入集成时，此时不太适合采用 Ambassador 服务。

下面是文章中一个简单的图例：

![](https://docs.microsoft.com/en-us/azure/architecture/patterns/_images/ambassador-example.png)。

--- 

以上是文件的简单翻译。个人感觉外交官模式和边车模式比较类似，但是从文中的内容来看，外交官模式更加侧重于请求代理，另外边车模式的生命周期与对应的应用的一致的。对于一对多形式的外交官模式，又和网关模式非常相似，这几个模式的核心思想主要还是尽量将业务无关的服务剥离出来吧。下面是网络上的一幅示意图：

![](https://upload-images.jianshu.io/upload_images/6688932-d1aa3212a21095b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/991/format/webp)。

可以看到边车、外交官模式都是针对于某个微服务做业务无关的一些操作。

### 三. Tips

### 四. Share